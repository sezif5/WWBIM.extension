# WW.BIM Update Script

## Описание
Скрипт автоматического обновления PyRevit extension WW.BIM из GitHub репозитория без использования version.txt.

## Репозиторий
- **GitHub:** https://github.com/sezif5/WW.BIM
- **Ветка:** main (с автоматическим fallback на master)

## Файлы
- `script.py` — основной скрипт обновления для PyRevit

## Как работает
1. Скрипт читает дату последнего обновления из локального `last_update.txt`
2. Получает дату последнего коммита через GitHub API
3. Сравнивает даты
4. Если на сервере новее — скачивает ZIP архив репозитория
5. Распаковывает во временную папку
6. Копирует файлы в папку extension (кроме пользовательских настроек)
7. Сохраняет новую дату в `last_update.txt`
8. Очищает временные файлы

## Установка в PyRevit Extension

### Структура папок
```
WW.BIM.extension/
└── WW.BIM.tab/
    └── Настройки.panel/
        └── Обновить.pushbutton/
            ├── script.py          ← скрипт обновления
            └── icon.png           ← иконка 32x32 (опционально)
```

**Примечание:** `last_update.txt` создается автоматически при первом обновлении.

### Настройки в скрипте (строки 22-24)
```python
GITHUB_USER = "sezif5"
GITHUB_REPO = "WW.BIM"
BRANCH = "main"
EXTENSION_NAME = "WW.BIM.extension"
```

## Требования
- PyRevit установлен
- Доступ к интернету (github.com)
- Python 2.7+ или Python 3.x (совместим с обоими)

## GitHub API
Скрипт использует GitHub API для получения даты последнего коммита:
- **Endpoint:** `GET /repos/{owner}/{repo}/commits/{branch}`
- **Rate limiting:** 60 запросов/час для неавторизованных запросов
- Достаточно для одного обновления

## Файлы которые НЕ перезаписываются
- `user_config.json`
- `local_settings.py`
- `.user`
- `last_update.txt`
- Любые файлы начинающиеся с `.git`

## Возможные доработки
- [ ] Добавить changelog — показывать что нового в версии
- [ ] Резервное копирование перед обновлением
- [ ] Проверка совместимости с версией Revit
- [ ] Уведомление о новой версии при запуске Revit (startup script)

## Troubleshooting

### "Не удалось подключиться к серверу"
- Проверьте интернет-соединение
- Проверьте доступ к github.com (корпоративный firewall?)
- Проверьте правильность GITHUB_USER и GITHUB_REPO
- Проверьте что GitHub API доступен (rate limit 60/час для неавторизованных)

### "Не удалось определить путь к плагину"
- Скрипт должен находиться внутри папки .extension
- Или выберите папку вручную в диалоговом окне

### Обновление не применяется
- Перезапустите Revit после обновления
- Проверьте права на запись в папку extension
